{"version":3,"sources":["webpack:///webpack/bootstrap bd48418c33c670d17ad0?ca1c","webpack:///./src/content.js"],"names":["host","ICIBA","__$ICIBA","DictWrap","$","DICT","hide","document","body","append","IF_TRANSLATE_SELECTION","LAST_MOUSE_DOWN","SELECTION_STAT","STOP_CLICK_HIDE","getSettings","settings","chrome","storage","onChanged","addListener","callback","changes","setting_huaci","newValue","bind","e","stopPropagation","button","searchSelection","extension","onMessage","msg","type","textValidate","text","match","getSelectedTxt","offset","getMouseCoords","pos","getPosition","x","y","width","height","css","top","left","show","searchWord","txt","selection","createRange","getSelection","toString","trim","ev","mouse_x","mouse_y","all","pageX","pageY","documentElement","scrollLeft","clientX","scrollTop","clientY","refer","tooltip","container","GAP","DOC","WIN","window","winWidth","winHeight","referW","referH","referX","referY","tooltipW","tooltipH","result"],"mappings":"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","file":"content.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap bd48418c33c670d17ad0\n **/","!(function( host ){\n\n    /**\n     * 初始化ICIBA节点和基本的词典功能\n     */\n    var ICIBA = host.__$ICIBA;\n    var DictWrap = $('<div class=\"iciba-extension-wrap\"></div>');\n    var DICT = new ICIBA.DICT( DictWrap );\n\n    // 默认隐藏词典\n    DictWrap.hide();\n    $( document.body ).append( DictWrap );\n\n    /**\n     * 是否开启划词翻译\n     */\n    var IF_TRANSLATE_SELECTION = false;\n\n    /**\n     * 最后一次的鼠标按下 event 对象\n     */\n    var LAST_MOUSE_DOWN = null;\n\n    /**\n     * 用于选中操作的动作记录  mousedown: 1, mousemove: 2 之后的 mouseup 才认为是selection\n     */\n    var SELECTION_STAT = null;\n\n    /**\n     * 是否禁用鼠标的click空白处关闭词典\n     * @type {boolean}\n     */\n    var STOP_CLICK_HIDE = false;\n\n    /**\n     * 获取默认配置项\n     */\n    ICIBA.getSettings(function( settings ){\n        IF_TRANSLATE_SELECTION = settings[ 'setting_huaci' ];\n\n        // 监控划词设置项的变更\n        chrome.storage.onChanged.addListener(function callback( changes ){\n            var setting_huaci = changes.setting_huaci;\n            if( setting_huaci ){\n                IF_TRANSLATE_SELECTION = setting_huaci.newValue;\n            }\n        });\n    });\n\n    /**\n     * 用于记录最后一次鼠标抬起的鼠标事件，用户计算选中文字位置\n     */\n    $( document).bind( 'mouseup', function( e ){\n        LAST_MOUSE_DOWN = e;\n    });\n\n    /**\n     * 点击空白处关闭词典\n     */\n    $( document).bind( 'click', function( e ){\n\n        if( STOP_CLICK_HIDE ){\n            STOP_CLICK_HIDE = false;\n        }\n        else {\n            DictWrap.hide();\n        }\n    });\n\n    DictWrap.bind( 'click', function( e ){\n        e.stopPropagation();\n    });\n\n    /**\n     * 划词的三个阶段 mousedown, mousemove, mouseup\n     */\n    $( document ).bind( 'mousedown', function( e ){\n        LAST_MOUSE_DOWN = e;\n\n        // 划词的动作仅仅记录左键，表面右键的干扰\n        if(e.button == 0){\n            SELECTION_STAT = 1;\n        }\n    });\n    $( document ).bind( 'mousemove', function(){\n        if( SELECTION_STAT == 1 || SELECTION_STAT == 2 ){\n            SELECTION_STAT = 2\n        }\n        else {\n            SELECTION_STAT = null;\n        }\n    });\n    $( document ).bind( 'mouseup', function( e ){\n\n        if( SELECTION_STAT == 2 && IF_TRANSLATE_SELECTION ){\n            searchSelection();\n            STOP_CLICK_HIDE = true;\n        }\n\n        SELECTION_STAT = null;\n    });\n\n    /**\n     * 浏览器的双击时会默认选词，因此也认为划词\n     */\n    $( document ).bind( 'dblclick', function( e ){\n        IF_TRANSLATE_SELECTION && searchSelection();\n    });\n\n    /**\n     * 监听bg那边发送过来的菜单“翻译选中文字”的功能\n     */\n    chrome.extension.onMessage.addListener(function( msg ){\n        if( msg ){\n            if( msg.type == 'search' ){\n                searchSelection();\n            }\n        }\n    });\n\n    /**\n     * 不对URL等使用翻译\n     * /^((https?:\\/\\/)?(\\w+\\.)+\\w+)/  URL\n     * /^\\w+@(\\w+\\.)+\\w+/  邮箱\n     */\n    var textValidate = function( text ){\n        if( text && !text.match(/^((https?:\\/\\/)?(\\w+\\.)+\\w+)/) && !text.match(/^\\w+@(\\w+\\.)+\\w+/) ){\n            return true;\n        }\n        return false;\n    };\n\n    /**\n     * 翻译选中的文字\n     */\n    var searchSelection = function(){\n\n        var text = getSelectedTxt();\n\n        if( textValidate(text) ){\n            var offset = getMouseCoords( LAST_MOUSE_DOWN );\n            var pos = getPosition( {\n                x: offset.x,\n                y: offset.y,\n                width: 20,\n                height: 20\n            }, {\n                width: 290,\n                height: 200\n            });\n\n            DictWrap.css({\n                top: pos.y,\n                left: pos.x\n            });\n            DictWrap.show();\n            DICT.searchWord( text );\n        }\n    };\n\n    /**\n     * 获取页面当前选中的单词\n     * @returns {string}\n     */\n    var getSelectedTxt = function(){\n        var txt = \"\";\n        if(document.selection) {\n            txt = document.selection.createRange().text;\n        } else {\n            txt = document.getSelection();\n        }\n        return txt.toString().trim();\n    };\n\n    /**\n     * 根据鼠标事件，获取坐标\n     * @param ev\n     * @returns {{x: *, y: *}}\n     */\n    var getMouseCoords = function( ev ){\n\n        var mouse_x;\n        var mouse_y;\n\n        if(!document.all){\n            mouse_x=ev.pageX;\n            mouse_y=ev.pageY;\n        }else{\n            mouse_x=document.documentElement.scrollLeft+ev.clientX;\n            mouse_y=document.documentElement.scrollTop+ev.clientY;\n        }\n        return {\n            x:mouse_x,\n            y:mouse_y\n        };\n    };\n    \n    var getPosition = function( refer, tooltip, container ){\n\n        var GAP = 0;\n        var DOC = $( container || document );\n        var WIN = $( container || window );\n        var scrollTop = DOC.scrollTop();\n        var scrollLeft = DOC.scrollLeft();\n        var winWidth = WIN.width();\n        var winHeight = WIN.height();\n\n        var referW = refer.width;\n        var referH = refer.height;\n        var referX = refer.x;\n        var referY = refer.y;\n\n        var tooltipW = tooltip.width;\n        var tooltipH = tooltip.height;\n\n        var result = {\n            x: null,\n            y: null\n        };\n\n        // 现决定x的位置\n\n        // 左边比较宽\n        if( referX - scrollLeft > ( scrollLeft + winWidth ) - ( referX + referW ) ){\n            result.x = referX - tooltipW - GAP;\n        }\n        else {\n            result.x = referX + referW + GAP;\n        }\n\n        // 决定y的位置\n        if( referY - scrollTop > ( scrollTop + winHeight ) - ( referY + referH ) ){\n            result.y = referY - tooltipH - GAP;\n        }\n        else {\n            result.y = referY + referH + GAP;\n        }\n\n        return result;\n    };\n\n})( this );\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/content.js\n **/"],"sourceRoot":""}